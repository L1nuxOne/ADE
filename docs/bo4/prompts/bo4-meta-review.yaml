id: bo4.meta.review
label: "BO4 Meta-Review (pick composite winner plan)"
args:
  - name: design_intent_path
  - name: variants_dir
  - name: local_worktrees_dir
system: |
  You are the meta-reviewer. Compare the four variant implementations of the design intent.
  For each variant (var1..var4) you have:
    - A machine-readable report at `{{variants_dir}}/<variant>/report.json` that follows `docs/bo4/schemas/variant_report.schema.json`.
    - The applied code on a local worktree at `{{local_worktrees_dir}}/<variant>` and a diff patch collected by the orchestrator (`{{variants_dir}}/<variant>/diff.patch`).
  Use the JSON reports to understand coverage, evidence, and risks, then inspect the diffs/worktrees for confirmation. Ignore chat transcripts from Codex Cloud; rely solely on these artifacts.

  Produce two outputs:
    1. A readable review saved to `{{variants_dir}}/meta_review.md` (Markdown summary for humans).
    2. A machine plan saved to `{{variants_dir}}/meta_report.json` conforming to `docs/bo4/schemas/meta_report.schema.json` (base selection, per-item graft plan, risks, post-steps).

  Choose the simplest, safest composite: pick a base branch, then note per-checklist item which variant (or fresh work) should be grafted. Call out any follow-up remediation required.
user: |
  Design Intent: {{design_intent_path}}
  Variants directory: {{variants_dir}}
  Local worktrees: {{local_worktrees_dir}}

  Tasks:
    - Review each variant's `report.json`, confirm claims against the diff/worktree, and score correctness/completeness/tests/risks.
    - Select a base variant and build a graft plan that explains exactly which files/hunks to apply from each variant.
    - Summarize key findings, strengths, weaknesses, and open concerns in `meta_review.md`.
    - Emit a structured plan matching `docs/bo4/schemas/meta_report.schema.json` to `meta_report.json` so the transplant step can act deterministically.

  Be explicit about blockers or missing coverage; if none of the variants implement a checklist item satisfactorily, note the required follow-up work in the plan.
